<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="dist/output.css" type="text/css" media="all" />
    <title>MyQuran - Home</title>
    <style type="text/css" media="all">
      .loading-indicator {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <div id="loading-indicator" class="scale-150 loading-indicator">
      <img src="./img/loading.gif" alt="Loading..." class="rounded-full" />
    </div>
    <input type="text" id="search-box" placeholder="🔍 Cari Surat..." class="block m-auto text-center border border-primary rounded-full border-2 bg-transparent p-3 my-8" />
    <section class="container letters grid md:grid-cols-2 gap-4 md:gap-8"></section>
    
    <script type="text/javascript" charset="utf-8">
      const letters = document.querySelector('.letters'),
        searchBox = document.querySelector('#search-box');
      const loadingIndicator = document.getElementById('loading-indicator');

      function showLoadingIndicator() {
        loadingIndicator.style.display = 'block';
      }

      function hideLoadingIndicator() {
        loadingIndicator.style.display = 'none';
      }
      // Panggil fungsi showLoadingIndicator sebelum permintaan API
      showLoadingIndicator();
      fetch("https://equran.id/api/v2/surat").then(res => res.json()).then(res => {
        // Proses respons API
        console.log(res)
        let xyz = "";
        for (surat of res.data) {
          xyz += `
						<div class="letter shadow-lg p-8 flex items-center gap-4 rounded-2xl hover:bg-primary hover:text-cyan-50 group transition-all duration-300 ease-in-out border border-primary border-2">
							<div class="rounded-full flex items-center justify-center h-10 w-10 border-dotted border-2 border-dark group-hover:border-cyan-50">${surat.nomor}</div>
							<div class="grid">
								<h4 class="font-bold">${surat.namaLatin} (${surat.nama})</h4>
								<div class="flex gap-3 text-xs">
									<p>${surat.arti} - </p>
									<p>${surat.jumlahAyat} Ayat</p>
								</div>
							</div>
						</div>
          `;
        }
        letters.innerHTML = xyz;
        // live search 
        const items = Array.from(letters.getElementsByClassName('letter'));
        searchBox.addEventListener('input', function() {
          const searchValue = this.value.toLowerCase();
          items.forEach(item => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(searchValue) ? '' : 'none';
          });
        });
        // save api surat yang diklik pada session
        for (const item of items) {
          item.addEventListener('click', () => {
            const url = `https://equran.id/api/v2/surat/${item.children[0].textContent}`;
            // Menyimpan URL pada sessionStorage
            sessionStorage.setItem('clickedUrl', url);
            window.location.href = 'surat.html';
          });
        }
        // Panggil fungsi hideLoadingIndicator setelah respons API diterima
        hideLoadingIndicator();
      }).catch(error => {
        // Tangani kesalahan
        // Panggil fungsi hideLoadingIndicator jika terjadi kesalahan
        hideLoadingIndicator();
      });
    </script>
  </body>
</html>