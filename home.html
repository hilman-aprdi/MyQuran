<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="dist/output.css" type="text/css" media="all" />
    <title>MyQuran - Home</title>
    <style type="text/css" media="all">
      
      #desk:checked ~ .deskripsi {
        display: block!important;
      }
      .lds-ellipsis {
        display: inline-block;
        position: relative;
        width: 80px;
        height: 80px;
      }
      .lds-ellipsis div {
        position: absolute;
        top: 33px;
        width: 13px;
        height: 13px;
        border-radius: 50%;
        background: #fff;
        animation-timing-function: cubic-bezier(0, 1, 1, 0);
      }
      .lds-ellipsis div:nth-child(1) {
        left: 8px;
        animation: lds-ellipsis1 0.6s infinite;
      }
      .lds-ellipsis div:nth-child(2) {
        left: 8px;
        animation: lds-ellipsis2 0.6s infinite;
      }
      .lds-ellipsis div:nth-child(3) {
        left: 32px;
        animation: lds-ellipsis2 0.6s infinite;
      }
      .lds-ellipsis div:nth-child(4) {
        left: 56px;
        animation: lds-ellipsis3 0.6s infinite;
      }
      @keyframes lds-ellipsis1 {
        0% {
          transform: scale(0);
        }
        100% {
          transform: scale(1);
        }
      }
      @keyframes lds-ellipsis3 {
        0% {
          transform: scale(1);
        }
        100% {
          transform: scale(0);
        }
      }
      @keyframes lds-ellipsis2 {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(24px, 0);
        }
      }

    </style>
  </head>
  <body class="bg-sky-50">
    <div id="loading-indicator" class="flex items-center justify-center loading-indicator fixed top-0 bg-primary hidden h-screen w-screen z-50">
      <div class="text-center">
        <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
        <p class="animate-pulse text-xl font-bold text-white">Loading...</p>
        <p class="text-[5px] font-bold text-white">MyQuran</p>
      </div>
    </div>
    
    
    <input type="text" id="search-box" placeholder="üîç Cari Surat..." class="block m-auto text-center border border-primary rounded-full border-2 bg-transparent p-3 my-8" />
    
    <a href="#" class="fixed bg-primary/50 backdrop-blur-md rounded-full h-10 w-10 grid place-items-center top-[90vh] right-10 animate-bounce">‚òùÔ∏è</a>
    
    <section class="container surat-cont grid md:grid-cols-2 gap-4 md:gap-8">
    </section>
    
    <div class="hidden ayat-cont flex flex-col items-center">
      <div class="flex flex-wrap flex-col md:flex-row justify-center items-center gap-8 text-sm text-white container">
        <audio class="audio rounded-full border border-2 border-primary" controls preload="none">
        </audio>
        <div class="flex flex-wrap gap-5 justify-center">
          <select class="qari p-3 font-bold rounded-lg bg-primary">
          <option value="01">Abdullah Al Juhany</option>
          <option value="02">Abdul Muhsin Al Qasim</option>
          <option value="03">Abdurrahman as Sudais</option>
          <option value="04">Ibrahim Al Dosari</option>
          <option value="05">Misyari Rasyid Al-Afasi</option>
        </select>
          <input type="checkbox" class="sr-only" id="desk"/>
          <button class="bg-primary font-bold rounded-lg p-3 tafsir-btn" onclick="tafsirSurat()">Tafsir</button>
          <label for="desk" class="bg-primary font-bold rounded-lg p-3">Deskripsi</label>
          <p class="deskripsi peer-checked:hidden mt-5 text-black border-dotted border-primary border-2 rounded-lg p-7 hidden bg-white leading-7"></p>
        </div>
      </div>
      
      <section class="surat p-5">
      </section>
    </div>
    
    <section class="tafsir-cont hidden container">
    </section>
    
    <script type="text/javascript" charset="utf-8">
      let suratContainer = document.querySelector('.surat-cont'),
      searchBox = document.querySelector('#search-box'),
      loadingIndicator = document.querySelector('.loading-indicator'),
      ayatContainer = document.querySelector('.ayat-cont'),
      tafsirContainer = document.querySelector('.tafsir-cont')
      qari = document.querySelector('.qari'),
      audioFull = document.querySelector('audio');
      suratURL = "";

     function tafsirSurat() {
       tafsirContainer.classList.remove("hidden")
       suratContainer.classList.add("hidden");
       ayatContainer.classList.add("hidden");
       loadingIndicator.style.display = 'flex';
       const id = ayatContainer.querySelector('.ayat-elem').dataset.id;
       fetch(`https://equran.id/api/v2/tafsir/${id}`)
         .then(res => res.json()).then(res => {
           loadingIndicator.style.display = 'none';
           let tafsirHTML = '';
           res.data.tafsir.forEach((ayat, index) => {
             index+=1;
             tafsirHTML += `
               <div class="my-4 md:mx-8">
                 <input type="checkbox" id="tafsir${index}" class="peer sr-only" />
                 <label for="tafsir${index}" class="text-xl font-bold bg-primary block p-4 text-white rounded-lg peer-checked:rounded-b-none flex justify-between hover:opacity-75 transition">
                   <span>Ayat ke-${index}</span>
                   <span>üìñ</span>
                 </label>
                 <p class="px-1.5 py-2 hidden border border-primary border-4 rounded-b-lg peer-checked:block">${ayat.teks}</p>
               </div>`;
           })
           tafsirContainer.innerHTML = tafsirHTML;
         })
     }
     
loadingIndicator.style.display = 'flex';
fetch("https://equran.id/api/v2/surat")
  .then(response => response.json())
  .then(data => {
    // Proses respons API
    console.log(data);
    let suratHTML = "";
    for (const surat of data.data) {
      suratHTML += `
        <div class="letter shadow-lg p-8 flex items-center gap-4 rounded-2xl hover:bg-primary hover:text-cyan-50 group transition-all duration-300 ease-in-out border border-primary border-2 BG">
          <div class="rounded-full flex items-center justify-center h-10 w-10 border-dotted border-2 border-dark group-hover:border-cyan-50">${surat.nomor}</div>
          <div class="grid">
            <h4 class="font-bold">${surat.namaLatin} (${surat.nama})</h4>
            <div class="flex gap-3 text-xs">
              <p>${surat.arti} - </p>
              <p>${surat.jumlahAyat} Ayat</p>
            </div>
          </div>
        </div>
      `;
    }
    suratContainer.innerHTML = suratHTML;

    // Live search
    const suratItems = Array.from(suratContainer.getElementsByClassName('letter'));
    searchBox.addEventListener('input', function() {
      const searchValue = this.value.toLowerCase();
      suratItems.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(searchValue) ? '' : 'none';
      });
    });


    for (const item of suratItems) {
      item.addEventListener('click', () => {
        searchBox.classList.add("hidden")
        loadingIndicator.style.display = 'flex';
        const suratNumber = item.children[0].textContent;
        suratURL = `https://equran.id/api/v2/surat/${suratNumber}`;
        fetch(suratURL)
          .then(res => res.json())
          .then(res => {
            loadingIndicator.style.display = 'none';
            console.log(res.data.audioFull["05"])
            const ayats = res.data.ayat.map(ayat => createAyatElement(ayat, ayat.audio['02'], res.data.nomor));
              audioFull.innerHTML = `<source src="${res.data.audioFull["05"]}"></source>`;
              document.querySelector('.deskripsi').innerHTML = res.data.deskripsi;
              document.querySelector('.surat').innerHTML = ayats.join('');
          });
            suratContainer.classList.add("hidden")
            ayatContainer.classList.remove("hidden")

          });
        }
        loadingIndicator.style.display = 'none';
      })
    
    // buat element ayat
    function createAyatElement(ayat, audio, nomor) {
      return `
        <div class="container ayat-elem my-6 shadow-lg rounded-2xl p-4" data-id="${nomor}">
          <p class="text-center mb-3">${ayat.nomorAyat}:${nomor}</p>
          <p class="text-center">
            <audio src="${audio}" preload="none" ></audio>
            <button class="text-4xl mb-5 text-center" onclick="toggleAudio(this)">${ayat.teksArab}<span class="mt-5 block text-sm">üîä</span></button>
          </p>
          <p class="border-b border-b-2 border-b-black pb-2 italic text-sm">${ayat.teksLatin}</p>
          <p class="mt-2 text-sm">${ayat.teksIndonesia}</p>
        </div>`;
    }
    
    qari.addEventListener("change", () => {
      fetch(suratURL)
        .then(res => res.json()).then(res => {
          const ayats = res.data.ayat.map(ayat => createAyatElement(ayat, ayat.audio[qari.value], res.data.nomor));
            document.querySelector('.surat').innerHTML = ayats.join('');
        })
    })
    
    // putar audio saat ayat diklik
    function toggleAudio(button) {
      const audio = button.parentNode.querySelector('audio');
      if (audio.paused) {
        audio.play();
      } else {
        audio.pause();
        audio.currentTime = 0;
      }
    }
    
 /*
history.pushState(null, null, location.href);
window.addEventListener('popstate', () => {
  if (suratContainer.classList.contains("hidden")) {
    ayatContainer.classList.add("hidden");
    tafsirContainer.classList.add("hidden");
    suratContainer.classList.remove("hidden");
    searchBox.classList.remove("hidden");
  } else {
    window.history.go(-1);
    console.log(window.history)
  }
})

window.addEventListener('popstate', () => {
  history.pushState(null, null, location.href);
});
*/


    </script>
  </body>
</html>